{"version":3,"file":"observers-CbO7gD6I.js","sources":["../../node_modules/@amplitude/session-replay-browser/lib/esm/observers.js"],"sourcesContent":["import { __awaiter, __generator } from \"tslib\";\nimport { getGlobalScope } from '@amplitude/analytics-core';\nvar NetworkObservers = /** @class */ (function () {\n    function NetworkObservers() {\n        this.fetchObserver = null;\n    }\n    NetworkObservers.prototype.start = function (eventCallback) {\n        this.eventCallback = eventCallback;\n        this.observeFetch();\n    };\n    NetworkObservers.prototype.stop = function () {\n        var _a;\n        (_a = this.fetchObserver) === null || _a === void 0 ? void 0 : _a.call(this);\n        this.fetchObserver = null;\n        this.eventCallback = undefined;\n    };\n    NetworkObservers.prototype.notifyEvent = function (event) {\n        var _a;\n        (_a = this.eventCallback) === null || _a === void 0 ? void 0 : _a.call(this, event);\n    };\n    NetworkObservers.prototype.observeFetch = function () {\n        var _this = this;\n        var globalScope = getGlobalScope();\n        if (!globalScope)\n            return;\n        var originalFetch = globalScope.fetch;\n        if (!originalFetch)\n            return;\n        globalScope.fetch = function (input, init) { return __awaiter(_this, void 0, void 0, function () {\n            var startTime, requestEvent, response, endTime, headers_1, error_1, endTime, typedError;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        startTime = Date.now();\n                        requestEvent = {\n                            timestamp: startTime,\n                            type: 'fetch',\n                            method: (init === null || init === void 0 ? void 0 : init.method) || 'GET',\n                            url: input.toString(),\n                            requestHeaders: init === null || init === void 0 ? void 0 : init.headers,\n                        };\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, originalFetch(input, init)];\n                    case 2:\n                        response = _a.sent();\n                        endTime = Date.now();\n                        requestEvent.status = response.status;\n                        requestEvent.duration = endTime - startTime;\n                        headers_1 = {};\n                        response.headers.forEach(function (value, key) {\n                            headers_1[key] = value;\n                        });\n                        requestEvent.responseHeaders = headers_1;\n                        this.notifyEvent(requestEvent);\n                        return [2 /*return*/, response];\n                    case 3:\n                        error_1 = _a.sent();\n                        endTime = Date.now();\n                        requestEvent.duration = endTime - startTime;\n                        typedError = error_1;\n                        requestEvent.error = {\n                            name: typedError.name || 'UnknownError',\n                            message: typedError.message || 'An unknown error occurred',\n                        };\n                        this.notifyEvent(requestEvent);\n                        throw error_1;\n                    case 4: return [2 /*return*/];\n                }\n            });\n        }); };\n        this.fetchObserver = function () {\n            globalScope.fetch = originalFetch;\n        };\n    };\n    return NetworkObservers;\n}());\nexport { NetworkObservers };\n//# sourceMappingURL=observers.js.map"],"names":["NetworkObservers","eventCallback","_a","event","_this","globalScope","getGlobalScope","originalFetch","input","init","__awaiter","startTime","requestEvent","response","endTime","headers_1","error_1","typedError","__generator","value","key"],"mappings":"6WAEG,IAACA,EAAkC,UAAY,CAC9C,SAASA,GAAmB,CACxB,KAAK,cAAgB,IAC7B,CACI,OAAAA,EAAiB,UAAU,MAAQ,SAAUC,EAAe,CACxD,KAAK,cAAgBA,EACrB,KAAK,aAAY,CACzB,EACID,EAAiB,UAAU,KAAO,UAAY,CAC1C,IAAIE,GACHA,EAAK,KAAK,iBAAmB,MAAQA,IAAO,QAAkBA,EAAG,KAAK,IAAI,EAC3E,KAAK,cAAgB,KACrB,KAAK,cAAgB,MAC7B,EACIF,EAAiB,UAAU,YAAc,SAAUG,EAAO,CACtD,IAAID,GACHA,EAAK,KAAK,iBAAmB,MAAQA,IAAO,QAAkBA,EAAG,KAAK,KAAMC,CAAK,CAC1F,EACIH,EAAiB,UAAU,aAAe,UAAY,CAClD,IAAII,EAAQ,KACRC,EAAcC,EAAc,EAChC,GAAKD,EAEL,KAAIE,EAAgBF,EAAY,MAC3BE,IAELF,EAAY,MAAQ,SAAUG,EAAOC,EAAM,CAAE,OAAOC,EAAUN,EAAO,OAAQ,OAAQ,UAAY,CAC7F,IAAIO,EAAWC,EAAcC,EAAUC,EAASC,EAAWC,EAASF,EAASG,EAC7E,OAAOC,EAAY,KAAM,SAAUhB,EAAI,CACnC,OAAQA,EAAG,MAAK,CACZ,IAAK,GACDS,EAAY,KAAK,IAAG,EACpBC,EAAe,CACX,UAAWD,EACX,KAAM,QACN,QAASF,GAAS,KAA0B,OAASA,EAAK,SAAW,MACrE,IAAKD,EAAM,SAAQ,EACnB,eAAgBC,GAAS,KAA0B,OAASA,EAAK,OAC7F,EACwBP,EAAG,MAAQ,EACf,IAAK,GACD,OAAAA,EAAG,KAAK,KAAK,CAAC,EAAG,EAAC,CAAI,CAAC,CAAC,EACjB,CAAC,EAAaK,EAAcC,EAAOC,CAAI,CAAC,EACnD,IAAK,GACD,OAAAI,EAAWX,EAAG,KAAI,EAClBY,EAAU,KAAK,IAAG,EAClBF,EAAa,OAASC,EAAS,OAC/BD,EAAa,SAAWE,EAAUH,EAClCI,EAAY,CAAA,EACZF,EAAS,QAAQ,QAAQ,SAAUM,EAAOC,EAAK,CAC3CL,EAAUK,CAAG,EAAID,CAC7C,CAAyB,EACDP,EAAa,gBAAkBG,EAC/B,KAAK,YAAYH,CAAY,EACtB,CAAC,EAAcC,CAAQ,EAClC,IAAK,GACD,MAAAG,EAAUd,EAAG,KAAI,EACjBY,EAAU,KAAK,IAAG,EAClBF,EAAa,SAAWE,EAAUH,EAClCM,EAAaD,EACbJ,EAAa,MAAQ,CACjB,KAAMK,EAAW,MAAQ,eACzB,QAASA,EAAW,SAAW,2BAC3D,EACwB,KAAK,YAAYL,CAAY,EACvBI,EACV,IAAK,GAAG,MAAO,CAAC,CAAC,CACrC,CACA,CAAa,CACb,CAAS,CAAE,EACH,KAAK,cAAgB,UAAY,CAC7BX,EAAY,MAAQE,CAChC,GACA,EACWP,CACX,EAAC","x_google_ignoreList":[0]}